## 14-2 보조 스트림

보조 스트림은 실제 데이터에 직접 입출력을 수행하지 않고, 다른 스트림과 연결되어 보조 기능을 제공한다.  
즉, 기반 스트림에 추가적인 기능을 덧붙이는 역할을 한다.

---

#### 보조 스트림 연결하기
- 보조 스트림은 단독으로 사용할 수 없고, 반드시 기반 스트림에 연결해서 사용한다.  
- 예: `new BufferedReader(new FileReader("file.txt"))`  
- 여러 보조 스트림을 중첩 연결할 수도 있다.

---

#### 문자 변환 보조 스트림
바이트 기반 스트림과 문자 기반 스트림 사이의 변환을 지원한다.

##### OutputStreamWriter
- 바이트 출력 스트림에 연결되어 문자 데이터를 바이트로 변환해 출력한다.  
- 인코딩 방식(UTF-8 등)을 지정할 수 있다.

##### InputStreamReader
- 바이트 입력 스트림에 연결되어 바이트 데이터를 문자로 변환해 읽는다.  
- 문자 집합(UTF-8, MS949 등)을 지정할 수 있다.

---

#### 성능 향상 보조 스트림
버퍼(Buffer)를 사용하여 입출력 성능을 향상시킨다.

##### BufferedOutputStream과 BufferedWriter
- 출력 시 내부 버퍼를 사용하여 데이터를 한 번에 모아 출력.  
- 작은 데이터를 여러 번 쓰는 경우 효율적이다.

##### BufferedInputStream과 BufferedReader
- 입력 시 버퍼를 사용해 여러 데이터를 미리 읽어둠.  
- 한 글자/바이트씩 읽는 경우 성능이 크게 향상된다.  
- `BufferedReader`는 `readLine()` 메소드로 한 줄 단위 읽기 가능.

---

#### 기본 타입 입출력 보조 스트림
- `DataInputStream`, `DataOutputStream` 클래스 제공.  
- 기본 타입(byte, int, double, boolean 등)을 입출력할 수 있다.  
- 바이너리 형태로 저장되므로 플랫폼에 상관없이 동일하게 사용 가능하다.

---

#### 프린터 보조 스트림
- `PrintStream`, `PrintWriter` 클래스 제공.  
- 다양한 타입의 데이터를 편리하게 출력 가능.  
- `print()`, `println()`, `printf()` 메소드 지원.  
- 화면 출력이나 로그 작성에 자주 활용된다.

---

#### 객체 입출력 보조 스트림
- `ObjectInputStream`, `ObjectOutputStream` 클래스 제공.  
- 객체를 직렬화(Serialization)하여 입출력할 수 있다.  
- 객체 저장 시 클래스는 반드시 `Serializable` 인터페이스를 구현해야 한다.  
- 객체 단위 저장/복원이 가능하다.

---

### 정리
1. 보조 스트림은 기반 스트림에 연결되어 기능을 추가한다.  
2. 문자 변환: `OutputStreamWriter`, `InputStreamReader`.  
3. 성능 향상: `BufferedInputStream`, `BufferedOutputStream`, `BufferedReader`, `BufferedWriter`.  
4. 기본 타입 입출력: `DataInputStream`, `DataOutputStream`.  
5. 프린터 스트림: `PrintStream`, `PrintWriter`.  
6. 객체 입출력: `ObjectInputStream`, `ObjectOutputStream`.  

# 마무리

## ▶ 5가지 키워드로 끝내는 핵심 포인트

• **보조 스트림**: 다른 스트림과 연결되어 여러 가지 편리한 기능을 제공해주는 스트림을 말합니다. 보조 스트림은 자체적으로 입출력을 수행할 수 없기 때문에 입출력 소스와 바로 연결되는 InputStream, OutputStream, Reader, Writer 등에 연결해서 입출력을 수행합니다. 보조 스트림은 문자 변환, 입출력 성능 향상, 기본 타입 입출력 등의 기능을 제공합니다.

• **문자 변환**: 소스 스트림이 바이트 기반 스트림(InputStream, OutputStream, FileInputStream, FileOutputStream)이면서 입출력 데이터가 문자라면 Reader와 Writer로 변환해서 사용하는 것을 고려할 수 있습니다. 그 이유는 문자 입출력은 Reader와 Writer가 편리하기 때문입니다. OutputStreamWriter는 Writer로 변환하는 보조 스트림이고, InputStreamReader는 Reader로 변환하는 보조 스트림입니다.

• **성능 향상**: 기본적으로 출력 스트림은 내부에 작은 버퍼를 가지고 있습니다. 하지만 이것만으로는 불충분합니다. 보조 스트림 중에는 메모리 버퍼를 추가로 제공하여 프로그램의 실행 성능을 향상시키는 것들이 있습니다. 바이트 기반 스트림에는 BufferedInputStream, BufferedOutputStream이 있고 문자 기반 스트림에는 BufferedReader, BufferedWriter가 있습니다.

• **기본 타입 입출력**: DataInputStream과 DataOutputStream 보조 스트림을 연결하면 기본 타입인 boolean, char, short, int, long, float, double을 입출력할 수 있습니다.

• **개행 출력**: PrintStream/PrintWriter의 println() 메소드는 출력할 데이터 끝에 개행 문자인 '\n'을 추가합니다. 그래서 출력 시 콘솔이나 파일에서 줄 바꿈이 일어납니다.

---

## ▶ 확인 문제

### 1. 보조 스트림에 대한 설명입니다. 맞는 것에 O표, 틀린 것에 X표 하세요.

① InputStreamReader는 InputStream을 Reader로 변환하는 보조 스트림이다. (    )
② BufferedInputStream은 데이터 읽기 성능을 향상시키는 보조 스트림이다. (    )
③ DataInputStream은 객체를 입출력하는 보조 스트림이다. (    )
④ PrintStream은 라인 단위로 출력할 수 있는 보조 스트림이다. (    )

**풀이**:
① InputStreamReader는 InputStream을 Reader로 변환하는 보조 스트림이다. **(O)**
② BufferedInputStream은 데이터 읽기 성능을 향상시키는 보조 스트림이다. **(O)**
③ DataInputStream은 객체를 입출력하는 보조 스트림이다. **(X)**
④ PrintStream은 라인 단위로 출력할 수 있는 보조 스트림이다. **(O)**

**③번 해설**: DataInputStream은 기본 타입(boolean, char, short, int, long, float, double)을 입출력하는 보조 스트림입니다. 객체 입출력은 ObjectInputStream/ObjectOutputStream이 담당합니다.

---

### 2. FileReader와 BufferedReader를 이용해서 source.txt 내용을 읽고, 각 라인 번호를 추가해서 모니터로 출력하는 프로그램을 작성해보세요.

**풀이**:
```java
// AddLineNumberExample.java
package sec02.verify.exam02;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;

public class AddLineNumberExample {
    public static void main(String[] args) throws IOException {
        String filePath = "src/sec02/verify/exam02/source.txt";
        
        // try-with-resources를 사용하여 자동으로 스트림 닫기
        try (FileReader fr = new FileReader(filePath);
             BufferedReader br = new BufferedReader(fr)) {
            
            int lineNumber = 1;
            String line;
            
            // 한 줄씩 읽어서 라인 번호와 함께 출력
            while ((line = br.readLine()) != null) {
                System.out.println(lineNumber + ": " + line);
                lineNumber++;
            }
            
        } catch (IOException e) {
            System.out.println("파일을 읽는 중 오류가 발생했습니다: " + e.getMessage());
        }
    }
}
```

**실행 결과 예시** (source.txt 내용에 따라):
```
1: package sec02.verify.exam02;
2: 
3: import java.io.BufferedReader;
4: import java.io.FileReader;
5: 
6: public class AddLineNumberExample {
7:    public static void main(String[] args) throws Exception {
8:        String filePath = "src/sec02/verify/exam02/AddLineNumberExample.java";
...
```

**핵심 포인트**:
- **FileReader**: 파일을 문자 단위로 읽는 기본 스트림
- **BufferedReader**: 성능 향상을 위한 버퍼링 기능 제공
- **readLine()**: 한 줄씩 읽어서 문자열로 반환 (줄바꿈 문자 제외)
- **null 반환**: 파일의 끝에 도달하면 null 반환

---

## 추가 학습 내용

### 보조 스트림의 종류와 특징

#### 1. 문자 변환 보조 스트림
**InputStreamReader** - InputStream → Reader 변환
```java
// 바이트 스트림을 문자 스트림으로 변환
FileInputStream fis = new FileInputStream("data.txt");
InputStreamReader isr = new InputStreamReader(fis, "UTF-8");
BufferedReader br = new BufferedReader(isr);

String line = br.readLine();
```

**OutputStreamWriter** - OutputStream → Writer 변환
```java
// 바이트 스트림을 문자 스트림으로 변환
FileOutputStream fos = new FileOutputStream("output.txt");
OutputStreamWriter osw = new OutputStreamWriter(fos, "UTF-8");
BufferedWriter bw = new BufferedWriter(osw);

bw.write("안녕하세요");
bw.flush();
```

#### 2. 성능 향상 보조 스트림
**BufferedInputStream/BufferedOutputStream**
```java
// 바이트 스트림 버퍼링
try (FileInputStream fis = new FileInputStream("input.dat");
     BufferedInputStream bis = new BufferedInputStream(fis);
     FileOutputStream fos = new FileOutputStream("output.dat");
     BufferedOutputStream bos = new BufferedOutputStream(fos)) {
    
    int data;
    while ((data = bis.read()) != -1) {
        bos.write(data);
    }
    bos.flush();
}
```

**BufferedReader/BufferedWriter**
```java
// 문자 스트림 버퍼링
try (FileReader fr = new FileReader("input.txt");
     BufferedReader br = new BufferedReader(fr);
     FileWriter fw = new FileWriter("output.txt");
     BufferedWriter bw = new BufferedWriter(fw)) {
    
    String line;
    while ((line = br.readLine()) != null) {
        bw.write(line);
        bw.newLine(); // 줄바꿈 추가
    }
    bw.flush();
}
```

#### 3. 기본 타입 입출력 보조 스트림
**DataInputStream/DataOutputStream**
```java
// 기본 타입 데이터 쓰기
try (FileOutputStream fos = new FileOutputStream("data.dat");
     DataOutputStream dos = new DataOutputStream(fos)) {
    
    dos.writeBoolean(true);
    dos.writeInt(100);
    dos.writeDouble(3.14);
    dos.writeUTF("Hello"); // UTF-8 문자열
    dos.flush();
}

// 기본 타입 데이터 읽기 (쓴 순서대로 읽어야 함)
try (FileInputStream fis = new FileInputStream("data.dat");
     DataInputStream dis = new DataInputStream(fis)) {
    
    boolean boolValue = dis.readBoolean();
    int intValue = dis.readInt();
    double doubleValue = dis.readDouble();
    String stringValue = dis.readUTF();
    
    System.out.println("Boolean: " + boolValue);
    System.out.println("Int: " + intValue);
    System.out.println("Double: " + doubleValue);
    System.out.println("String: " + stringValue);
}
```

#### 4. 객체 입출력 보조 스트림
**ObjectInputStream/ObjectOutputStream**
```java
import java.io.Serializable;

// 직렬화 가능한 클래스
class Person implements Serializable {
    private static final long serialVersionUID = 1L;
    private String name;
    private int age;
    
    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }
    
    @Override
    public String toString() {
        return "Person{name='" + name + "', age=" + age + "}";
    }
}

// 객체 저장
try (FileOutputStream fos = new FileOutputStream("person.dat");
     ObjectOutputStream oos = new ObjectOutputStream(fos)) {
    
    Person person = new Person("홍길동", 25);
    oos.writeObject(person);
    oos.flush();
}

// 객체 읽기
try (FileInputStream fis = new FileInputStream("person.dat");
     ObjectInputStream ois = new ObjectInputStream(fis)) {
    
    Person person = (Person) ois.readObject();
    System.out.println(person);
}
```

#### 5. 출력 보조 스트림
**PrintStream/PrintWriter**
```java
// PrintWriter 사용 예제
try (FileWriter fw = new FileWriter("output.txt");
     PrintWriter pw = new PrintWriter(fw)) {
    
    pw.println("첫 번째 줄");
    pw.println("두 번째 줄");
    pw.printf("숫자: %d, 실수: %.2f%n", 100, 3.14159);
    pw.print("줄바꿈 없음");
    
    // 자동으로 flush() 호출
}
```

### 보조 스트림 연결 패턴

#### 다중 보조 스트림 연결
```java
// 여러 보조 스트림을 체인으로 연결
try (FileInputStream fis = new FileInputStream("input.txt");
     InputStreamReader isr = new InputStreamReader(fis, "UTF-8");
     BufferedReader br = new BufferedReader(isr)) {
    
    String line;
    while ((line = br.readLine()) != null) {
        System.out.println(line);
    }
}

// 더 간단한 방법
try (BufferedReader br = new BufferedReader(
         new InputStreamReader(
             new FileInputStream("input.txt"), "UTF-8"))) {
    
    String line;
    while ((line = br.readLine()) != null) {
        System.out.println(line);
    }
}
```

### 실무 활용 팁

#### 1. 성능 최적화
- 작은 단위의 잦은 I/O보다는 버퍼드 스트림 사용
- 적절한 버퍼 크기 설정 (기본값: 8192 바이트)

#### 2. 문자 인코딩 주의
- InputStreamReader/OutputStreamWriter 사용 시 인코딩 명시
- UTF-8, EUC-KR 등 적절한 인코딩 선택

#### 3. 리소스 관리
- try-with-resources 구문으로 자동 close() 보장
- 보조 스트림을 닫으면 연결된 기본 스트림도 자동으로 닫힘

#### 4. 예외 처리
- IOException은 checked exception이므로 반드시 처리
- 적절한 오류 메시지와 로깅 제공