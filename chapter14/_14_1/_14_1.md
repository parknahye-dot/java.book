# Chapter 14 입출력 스트림

## 14-1 입출력 스트림

자바에서 **스트림(Stream)** 은 데이터가 오가는 통로이다.  
입출력 스트림은 크게 **바이트 기반 스트림**과 **문자 기반 스트림**으로 나뉜다.

---

#### 입출력 스트림의 종류

##### 바이트 기반 스트림
- 1바이트 단위로 데이터를 읽고 쓴다.
- 바이너리 데이터(이미지, 동영상, 실행 파일 등) 처리에 적합하다.
- 대표 클래스: `InputStream`, `OutputStream`

##### 문자 기반 스트림
- 2바이트 단위(UTF-16)로 문자를 처리한다.
- 문자 데이터(텍스트 파일 등)에 적합하다.
- 대표 클래스: `Reader`, `Writer`

---

#### 바이트 출력 스트림: OutputStream
모든 바이트 출력 스트림의 최상위 클래스이다.

- **write(int b)** : 1바이트 출력 (하위 1바이트만 사용).  
- **write(byte[] b)** : 바이트 배열 전체 출력.  
- **write(byte[] b, int off, int len)** : 바이트 배열의 일부만 출력.  

---

#### 바이트 입력 스트림: InputStream
모든 바이트 입력 스트림의 최상위 클래스이다.

- **read()** : 1바이트 읽기 (더 이상 없으면 -1 반환).  
- **read(byte[] b)** : 바이트 배열 크기만큼 읽고 배열에 저장, 읽은 개수를 반환.  
- **read(byte[] b, int off, int len)** : 배열의 일부에 읽은 데이터를 저장.  

---

#### 문자 출력 스트림: Writer
문자 기반 출력 스트림의 최상위 클래스이다.

- **write(int c)** : 한 문자를 출력.  
- **write(char[] cbuf)** : 문자 배열 전체 출력.  
- **write(char[] cbuf, int off, int len)** : 문자 배열의 일부 출력.  
- **write(String str)**, **write(String str, int off, int len)** : 문자열 또는 부분 문자열 출력.  

---

#### 문자 입력 스트림: Reader
문자 기반 입력 스트림의 최상위 클래스이다.

- **read(char[] cbuf)** : 문자 배열 크기만큼 읽고 배열에 저장.  
- **read(char[] cbuf, int off, int len)** : 배열의 특정 위치에 읽은 데이터를 저장.  

---

### 정리
1. 스트림은 바이트 기반(`InputStream`, `OutputStream`)과 문자 기반(`Reader`, `Writer`)으로 나뉜다.  
2. `write()`/`read()` 메소드로 데이터를 입출력한다.  
3. 배열 전체 또는 일부를 다루는 오버로딩 메소드들이 제공된다.  

# 마무리

## ▶ 5가지 키워드로 끝내는 핵심 포인트

• **입출력 스트림**: 자바에서 데이터는 스트림(Stream)을 통해 입출력됩니다. 프로그램이 출발지나 또는 도착지냐에 따라서 사용하는 스트림의 종류가 결정됩니다. 프로그램이 도착지면 출력 데이터를 입력받아야 하므로 입력 스트림을 사용합니다. 반대로 프로그램이 출발지면 데이터를 출력해야 하므로 출력 스트림을 사용합니다.

• **InputStream**: 바이트 기반 입력 스트림의 최상위 클래스로 추상 클래스입니다. 모든 바이트 기반 입력 스트림은 InputStream 클래스를 상속받아서 만들어집니다. InputStream 클래스에는 바이트 기반 입력 스트림이 기본적으로 가져야 할 메소드가 정의되어 있습니다.

• **OutputStream**: 바이트 기반 출력 스트림의 최상위 클래스로 추상 클래스입니다. 모든 바이트 기반 출력 스트림 클래스는 OutputStream 클래스를 상속받아서 만들어집니다. OutputStream 클래스에는 모든 바이트 기반 출력 스트림이 기본적으로 가져야 할 메소드가 정의되어 있습니다.

• **Reader**: 문자 기반 입력 스트림의 최상위 클래스로 추상 클래스입니다. 모든 문자 기반 입력 스트림은 Reader 클래스를 상속받아서 만들어집니다. Reader 클래스에는 문자 기반 입력 스트림이 기본적으로 가져야 할 메소드가 정의되어 있습니다.

• **Writer**: 문자 기반 출력 스트림의 최상위 클래스로 추상 클래스입니다. 모든 문자 기반 출력 스트림 클래스는 Writer 클래스를 상속받아서 만들어집니다. Writer 클래스에는 모든 문자 기반 출력 스트림이 기본적으로 가져야 할 메소드가 정의되어 있습니다.

---

## ▶ 확인 문제

### 1. 입출력 스트림에 대한 설명입니다. 맞는 것에 O표, 틀린 것에 X표 하세요.

① 하나의 스트림으로 입력과 출력이 동시에 가능하다. (    )
② 프로그램을 기준으로 데이터가 들어오면 입력 스트림이다. (    )
③ 프로그램을 기준으로 데이터가 나가면 출력 스트림이다. (    )
④ 파일에 데이터를 저장하려면 출력 스트림을 사용해야 한다. (    )

**풀이**:
① 하나의 스트림으로 입력과 출력이 동시에 가능하다. **(X)**
② 프로그램을 기준으로 데이터가 들어오면 입력 스트림이다. **(O)**
③ 프로그램을 기준으로 데이터가 나가면 출력 스트림이다. **(O)**
④ 파일에 데이터를 저장하려면 출력 스트림을 사용해야 한다. **(O)**

**①번 해설**: 스트림은 단방향입니다. 입력과 출력을 위해서는 각각 별도의 스트림이 필요합니다.

---

### 2. InputStream과 Reader에 대한 설명입니다. 맞는 것에 O표, 틀린 것에 X표 하세요.

① 어디서 데이터는 InputStream 또는 Reader로 모두 읽을 수 있다. (    )
② Reader의 read() 메소드는 1문자를 읽고 리턴한다. (    )
③ InputStream의 read() 메소드는 1byte를 읽고 리턴한다. (    )
④ InputStream의 read(byte[] b) 메소드는 읽은 바이트 수를 리턴한다. (    )

**풀이**:
① 어디서 데이터는 InputStream 또는 Reader로 모두 읽을 수 있다. **(X)**
② Reader의 read() 메소드는 1문자를 읽고 리턴한다. **(O)**
③ InputStream의 read() 메소드는 1byte를 읽고 리턴한다. **(O)**
④ InputStream의 read(byte[] b) 메소드는 읽은 바이트 수를 리턴한다. **(O)**

**①번 해설**: InputStream은 바이트 기반이고 Reader는 문자 기반입니다. 데이터의 특성에 따라 적절한 스트림을 선택해야 합니다.

---

### 3. InputStream의 read(byte[] b, int off, int len) 메소드에 대한 설명입니다. 맞는 것에 O표, 틀린 것에 X표 하세요.

① 메소드의 리턴값은 읽은 바이트 수이다. (    )
② 첫 번째 매개값 b에는 읽은 데이터가 저장된다. (    )
③ 두 번째 매개값 off는 첫 번째 매개값 b에서 데이터가 저장될 시작 인덱스이다. (    )
④ 세 번째 매개값 len은 첫 번째 매개값 b에서 데이터가 저장될 마지막 인덱스이다. (    )

**풀이**:
① 메소드의 리턴값은 읽은 바이트 수이다. **(O)**
② 첫 번째 매개값 b에는 읽은 데이터가 저장된다. **(O)**
③ 두 번째 매개값 off는 첫 번째 매개값 b에서 데이터가 저장될 시작 인덱스이다. **(O)**
④ 세 번째 매개값 len은 첫 번째 매개값 b에서 데이터가 저장될 마지막 인덱스이다. **(X)**

**④번 해설**: `len`은 마지막 인덱스가 아니라 **읽을 바이트의 수**입니다.

**메소드 시그니처 해설**:
- `read(byte[] b, int off, int len)`
- `b`: 데이터를 저장할 바이트 배열
- `off`: 배열에서 데이터 저장을 시작할 인덱스
- `len`: 읽을 바이트의 개수 (길이)

---

### 4. 출력 스트림에서 데이터를 출력한 후 flush() 메소드를 호출하는 이유가 무엇입니까?

① 출력 스트림의 버퍼에 있는 데이터를 모두 출력하고 버퍼를 비운다.
② 출력 스트림을 메모리에서 제거한다.
③ 출력 스트림의 버퍼에 있는 데이터를 모두 삭제한다.
④ 출력 스트림을 닫은 역할을 한다.

**풀이**: 
**정답: ①**

**해설**:
- **flush()의 역할**: 출력 스트림의 내부 버퍼에 임시 저장된 데이터를 강제로 출력하고 버퍼를 비웁니다.
- **왜 필요한가**: 성능 향상을 위해 데이터를 즉시 출력하지 않고 버퍼에 모아뒀다가 일정량이 차면 출력하는데, flush()를 호출하면 버퍼가 가득 차지 않아도 즉시 출력됩니다.
- **② 스트림 제거**: close() 메소드의 역할
- **③ 데이터 삭제**: flush()는 삭제가 아니라 출력 후 버퍼를 비움
- **④ 스트림 닫기**: close() 메소드의 역할

---

## 추가 학습 내용

### 스트림의 분류

#### 1. 방향에 따른 분류
- **입력 스트림**: 외부에서 프로그램으로 데이터 읽기
- **출력 스트림**: 프로그램에서 외부로 데이터 쓰기

#### 2. 데이터 타입에 따른 분류

**바이트 스트림** (Binary Data)
- **입력**: InputStream → FileInputStream, BufferedInputStream
- **출력**: OutputStream → FileOutputStream, BufferedOutputStream
- **특징**: 이미지, 동영상, 음성 등 모든 종류의 데이터

**문자 스트림** (Text Data)
- **입력**: Reader → FileReader, BufferedReader
- **출력**: Writer → FileWriter, BufferedWriter
- **특징**: 텍스트 데이터, 유니코드 문자 처리

### 주요 메소드 정리

#### InputStream 주요 메소드
```java
int read()                    // 1바이트 읽기
int read(byte[] b)            // 배열 크기만큼 읽기
int read(byte[] b, int off, int len)  // 지정된 길이만큼 읽기
void close()                  // 스트림 닫기
```

#### OutputStream 주요 메소드
```java
void write(int b)             // 1바이트 쓰기
void write(byte[] b)          // 배열 전체 쓰기
void write(byte[] b, int off, int len)  // 지정된 범위 쓰기
void flush()                  // 버퍼 비우기
void close()                  // 스트림 닫기
```

#### Reader 주요 메소드
```java
int read()                    // 1문자 읽기
int read(char[] c)            // 배열 크기만큼 읽기
int read(char[] c, int off, int len)  // 지정된 길이만큼 읽기
void close()                  // 스트림 닫기
```

#### Writer 주요 메소드
```java
void write(int c)             // 1문자 쓰기
void write(char[] c)          // 배열 전체 쓰기
void write(char[] c, int off, int len)  // 지정된 범위 쓰기
void write(String str)        // 문자열 쓰기
void flush()                  // 버퍼 비우기
void close()                  // 스트림 닫기
```

### 실제 사용 예제

#### 파일 복사 (바이트 스트림)
```java
import java.io.*;

public class FileCopyExample {
    public static void main(String[] args) {
        try (FileInputStream fis = new FileInputStream("source.jpg");
             FileOutputStream fos = new FileOutputStream("copy.jpg")) {
            
            byte[] buffer = new byte[1024];
            int bytesRead;
            
            while ((bytesRead = fis.read(buffer)) != -1) {
                fos.write(buffer, 0, bytesRead);
            }
            
            fos.flush();
            System.out.println("파일 복사 완료");
            
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

#### 텍스트 파일 읽기/쓰기 (문자 스트림)
```java
import java.io.*;

public class TextFileExample {
    public static void main(String[] args) {
        // 텍스트 파일 쓰기
        try (FileWriter writer = new FileWriter("output.txt")) {
            writer.write("안녕하세요\n");
            writer.write("자바 입출력 스트림 예제입니다.\n");
            writer.flush();
        } catch (IOException e) {
            e.printStackTrace();
        }
        
        // 텍스트 파일 읽기
        try (FileReader reader = new FileReader("output.txt")) {
            char[] buffer = new char[100];
            int charsRead = reader.read(buffer);
            String content = new String(buffer, 0, charsRead);
            System.out.println(content);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### 버퍼드 스트림의 중요성
```java
import java.io.*;

public class BufferedStreamExample {
    public static void main(String[] args) {
        // 버퍼 없는 스트림 (느림)
        try (FileOutputStream fos = new FileOutputStream("test1.txt")) {
            for (int i = 0; i < 10000; i++) {
                fos.write("Hello World\n".getBytes());
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        
        // 버퍼 있는 스트림 (빠름)
        try (BufferedOutputStream bos = new BufferedOutputStream(
                new FileOutputStream("test2.txt"))) {
            for (int i = 0; i < 10000; i++) {
                bos.write("Hello World\n".getBytes());
            }
            // bos.flush(); // close()에서 자동으로 flush() 호출
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### 스트림 사용 시 주의사항
1. **반드시 close() 호출**: try-with-resources 구문 사용 권장
2. **적절한 스트림 선택**: 바이트 vs 문자 스트림
3. **버퍼 크기 최적화**: 너무 작으면 I/O 횟수 증가, 너무 크면 메모리 낭비
4. **예외 처리**: IOException은 checked exception이므로 반드시 처리